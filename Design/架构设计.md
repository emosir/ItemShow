# 用户端

## 需求分析

目标用户：高知水平的用户群体

需求解决：为项目找到合作者

平台：小程序

## 权限管理

游客无法使用的功能
- 获取文件
- 不提供个人页
- 搜索

允许且仅允许数据被owner、平台删除
- 团队的创建、删除需要提交申请

## 待办事项

事项
- 发起方Id、回应方Id、事项topic(不能自定义，由后端决定)
- 每次状态转移的输入、附带邮件、转移发生的时间的历史记录

邮件
- 发送方Id、发送时间、接收方Id
- 主题、文字流、一个文件、多张图片
- 邮件状态
  - 已发送未接收：0
  - 已发送已接收：1

申请创建团队：

![](Photos/2024-04-03-10-17-04.png)

申请加入团队

![](Photos/2024-04-04-11-47-24.png)
邀请加入团队

![](Photos/2024-04-04-11-47-01.png)

整改用户、项目、团队的资料

![](Photos/2024-04-04-11-46-36.png)

## 信息

单向发送的信息，可以附着在事项转移上

# 平台端


对所有数据的curl操作

与所有用户的沟通能力

# 技术栈

后端技术栈：SpringBoot、Shiro、MyBatis、MySql

前端技术栈：uniapp

工具：ApiPost




# 前端概要设计

设计思路：非固定的信息都由后端提供，前端仅负责显示固定的、非固定的信息以及美化
## 组件设计

包装<A HREF=https://uniapp.dcloud.net.cn/component/>uniapp提供的组件</A>并生成我们自己的可复用组件
### 一级页面、对外展示页使用的组件

#### Overview

接收图片、项目、团队的概要数据，并分页显示
- 效果图：
  - ![](Photos/2024-04-04-12-58-54.png)
- 概要数据的相同属性名
  - 入口处：id、imageIds、name、description
  - 对外展示页：likes、shares、fileId
- 图片、项目、团队概要数据的不同属性名
  - 项目：teamId、leaderId
  - 用户：gender、teamIds
  - 团队：leaderId、memberIds、projectIds
- 主要函数：
  1. 根据id的前四个字符判断该概要数据是user、item还是team
  2. 跳转到对外展示页，并传入概要数据 
- 主要data：概要数据数组

```JSON
"items":[
  {
        "id": "item2",
        "name": "Project 2",
        "description": "Description of Project 2",
        "fileId":"123",
        "imageIds": ["1","2"],
        "likes": 80,
        "shares": 30,
        "teamId": "2",
        "leaderId": "2",
  }
]


"user":[
    {
        "id": "user2",
        "name": "Project 2",
        "description": "Description of Project 2",
        "fileId":"123",
        "imageIds": ["1","2"],
        "likes": 80,
        "shares": 30,
        "gender": 1,
        "teamIds": ["team1", "team2"],

    }
]

"team":[
    {
        "id": "team2",
        "name": "Project 2",
        "description": "Description of Project 2",
        "fileId":"123",
        "imageIds": ["1","2"],
        "likes": 80,
        "shares": 30,
        "leaderId": "leader1",
        "memberIds": ["member1", "member2", "member3"],
        "projectIds": ["project1", "project2"],
    }
]

```


#### UserDetail、ItemDetail、TeamDetail

![](Photos/2024-04-08-13-55-19.png)

初始化函数
- 显示骨架图
- 接收跳转链接携带的数据存储在本地
  - 原数据是对象，将该对象的属性拆分存储
- 并行下载除第一张图片外的所有图片
- 图片准备好后取消骨架图显示数据，至少显示1秒的骨架图，即接收图片花费的时间可能小于1秒

使用的子组件
- Interaction
- Carousel
- Menu



#### Interaction

点赞、ID复制选项、分享

![](Photos/2024-04-08-13-55-58.png)

初始化函数：
- 接收父组件传递的数据：id、likes、shares并存储在组件实例中

主要函数
- 点赞、取消点赞
- 分享，调用wx接口，此处建议使用条件编译

#### Carousel

显示主题、图片

![](Photos/2024-04-08-13-56-25.png)

初始化函数
- 接收父组件传递的参数：name、已经下载好的图片的临时路径

#### Menu

![](Photos/2024-04-08-14-00-02.png)

![](Photos/2024-04-08-14-02-21.png)

![](Photos/2024-04-08-14-02-32.png)

![](Photos/2024-04-08-14-02-39.png)

初始化函数
- 接收两个列表，每个列表由相同属性名的对象组成
- 对象属性名：name、icon、navigatefn
  - 注意这些对象很可能会复用，建议记下来维护
- 第一个列表靠左，第二个列表靠右
- 如果只有第二个列表为undefined，即没有传递，就不显示该列表
- 对象的第三个参数是用于跳转的函数，如果没有就使用undefined占位

#### MembersAndRecruitment
 ![](Photos/2024-04-04-13-43-12.png)
 
 如何显示空缺职位自行决定，如果uniapp没有组件支持就直接使用文字表示
 
使用的组件
- Menu
- Members

api：获取团队的成员列表及空缺职位
#### Members

初始化函数
- 接收父组件传递的参数
- 跳转时跳转到用户展示页

### Owner修改数据使用的组件

#### ItemManagement、TeamManagement、UserManagement

尽管ItemManagement、TeamManagement界面是一样的，但是逻辑有一些差异，为了以后修改方便，建议两个组件分开写

初始化函数
- 接收跳转函数传递的参数
  - 建议使用一个参数flag判断是修改还是创建
- 创建
  - 如果是创建项目则要求传入团队id
  - 如果是创建团队则无需传入任何参数
- 修改
  - 要求传入详细信息，并且在当前修改页中显示
- 使用api：项目、团队数据修改
  - 注意提交操作是同步不可中断操作
- 有些提示信息可以优化一下，不用和墨刀上一模一样


#### HRManagement



使用api：团队人事

这个组件的逻辑比较复杂，实现的方法有很多种，建议最后做，看你们能用什么方法实现就可以用什么方法，我不多做限制，但是要求功能是不变的


## api设计

apipost中仅给出了正常的成功的响应，没有说明错误响应
- 在http报文中，响应报文头部的响应code指明报文状态，可自行搜索
- 在报文体中，通常会说明code、data、msg这些参数
- 为什么既有http报文的响应code，在报文体中又有一个code？
  - 因为http报文头部的响应code是200时，表示报文成功被客户端接收，但是其包含的信息对用户来说可能是错误信息
  - 因此报文的code是给客户端读的，而报文体中的code及其它信息是给用户读的
- msg是什么？
  - 通常是通知用户的信息
  - 比如：上传文件出错、上传文件成功等信息，通常msg字段是有的，如果有就需要反馈给用户


<A HREF=https://uniapp.dcloud.net.cn/api/request/request.html>uniapp提供网络函数</A>

- 包装uni.request(OBJECT)函数供普通的rest上层函数使用
- 下面是我以前写的函数，可以参考一下，主要使用的知识
  - 函数、module、promise、http&tcp&rest


```JS

const http = (url, method = 'GET', data = {},contentType='application/json') => {
    return new Promise((resolve, reject) => {
        uni.request({
            url:url,
            method:method,
            data:data,
            header: {
                'Content-Type': contentType,
            },
            success: (res) => {
                console.log(url+"\n"+JSON.stringify(res.data.data));
                if (res.data.code === 200) {
                    resolve(res);
                } else {
                    reject(res);
                }
            },
            fail: (error) => {
                reject(error);
            }
        });
    });
};

const innovationUrlPrefix = 'http://localhost:8060/innovation';


export default {http,innovationUrlPrefix};

```

```JS
import request from './common/http';

const fileUrl=request.innovationUrlPrefix+"/files"

const fileApi = {
    upload: (filePath, itemId,fileName) => {
        return new Promise((resolve, reject)=>{
            console.log(filePath,itemId)
            uni.uploadFile({
                url: `${fileUrl}/file?itemId=` + itemId+'&fileName='+fileName,
                filePath: filePath,
                name: "file",
                success: (res) => {
                    if (res.data.code === 200) {
                        resolve(res)
                    }else{
                        reject(res)
                    }
                },fail:(res)=>{
                    reject(res)
                }
            });
        })
    },
    delFile:(itemId,filename)=>{
        return request.http(`${fileUrl}/file`, 'DELETE', { itemId:itemId,filename:filename },'application/x-www-form-urlencoded');
    },
    checkoutFile: (suffix) => {
        return request.http(`${fileUrl}/checkout/file`, 'GET', { suffix:suffix });
    },
    checkoutVideo: (suffix) => {
        return request.http(`${fileUrl}/checkout/video`, 'GET', { suffix:suffix });
    },
    checkoutImage: (suffix) => {
        return request.http(`${fileUrl}/checkout/image`, 'GET', { suffix:suffix });
    },
    download: (itemId,filename) => {
        return new Promise((resolve, reject) => {
            uni.downloadFile({
                url: `${fileUrl}/download`+"?itemId="+itemId+"&filename="+filename,
                success: (res) => {
                    resolve(res.tempFilePath)
                },
                fail: (res) => {
                    reject(res);
                }
            })
        })
    },
    getLegalImage: () => {
        return request.http(`${fileUrl}/legal/image`, 'GET');
    },
    getLegalVideo: () => {
        return request.http(`${fileUrl}/legal/video`, 'GET');
    },
    getLegalFile: () => {
        return request.http(`${fileUrl}/legal/file`, 'GET');
    },
};

export default fileApi;

```

<A HREF=https://uniapp.dcloud.net.cn/api/request/network-file.html>提供文件相关的函数</A>
- 包装文件相关的函数直接供组件或页面使用
- 下面是我以前写的代码，可以参考

```JS

download: (itemId,filename) => {
    return new Promise((resolve, reject) => {
        uni.downloadFile({
            url: `${fileUrl}/download`+"?itemId="+itemId+"&filename="+filename,
            success: (res) => {
                resolve(res.tempFilePath)
            },
            fail: (res) => {
                reject(res);
            }
        })
    })
},

    upload: (filePath, itemId,fileName) => {
    return new Promise((resolve, reject)=>{
        console.log(filePath,itemId)
        uni.uploadFile({
            url: `${fileUrl}/file?itemId=` + itemId+'&fileName='+fileName,
            filePath: filePath,
            name: "file",
            success: (res) => {
                if (res.data.code === 200) {
                    resolve(res)
                }else{
                    reject(res)
                }
            },fail:(res)=>{
                reject(res)
            }
        });
    })
},
```

## 反馈设计

同步操作才会使用反馈，且大多与api绑定，显示由后端提供的成功或失败信息

是否可中断
- 例如下载文件是可中断的，上传团队用户项目的操作是不可中断的
- 不可中断操作仅显示进行中（如果有进度更好），可中断操作应额外提供可取消按钮

进入小程序的加载动画，在初始化程序时显示加载动画，加载动画至少显示2秒，并且在程序的初始化函数结束后进入程序
- 加载页面可以静态图像或动画

## 页面与路由设计

pages.json中设置：底部菜单栏和页面设置示例代码
```json
{
	"pages": [{
		"path": "pages/index/index",
		"style": {
			"navigationBarTitleText": "首页"
		}
	},{
		"path": "pages/user/user",
		"style": {
			"navigationBarTitleText": "个人空间管理"
		}
	},{
		"path": "pages/editor/editor",
		"style": {
			"navigationBarTitleText": "项目编辑"
		}
	},{
		"path": "pages/detail/detail",
		"style": {
			"navigationBarTitleText": "查看项目详细信息"
		}
	},{
		"path": "pages/preview/preview",
		"style": {
			"navigationBarTitleText": "预览"
		}
	},{
		"path": "pages/search/search",
		"style": {
			"navigationBarTitleText": "搜索"
		}
	}],
	"globalStyle": {
		"navigationBarTextStyle": "black",
		"navigationBarTitleText": "uni-app",
		"navigationBarBackgroundColor": "#F8F8F8",
		"backgroundColor": "#F8F8F8",
		"app-plus": {
			"background": "#efeff4"
		}
	},
	"tabBar": {
		"color": "#7A7E83",
		"selectedColor": "#3cc51f",
		"borderStyle": "black",
		"backgroundColor": "#ffffff",
		"list": [{
			"pagePath": "pages/index/index",
			"iconPath": "static/tabbar/indexUnchoose.png",
			"selectedIconPath": "static/tabbar/indexChoose.png",
			"text": "发现"
		},{
			"pagePath": "pages/user/user",
			"iconPath": "static/tabbar/userUnchoose.png",
			"selectedIconPath": "static/tabbar/userChoose.png",
			"text": "我的"
		}
		]
	}
}
```

### 一级页面

#### 首页：index


在程序初始化时调用api获取最新和最热的项目列表，并默认按最热的项目列表分页器显示

使用组件
- 搜索栏
- Overview


#### 团队工作台入口：workbenchEntrance

